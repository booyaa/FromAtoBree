<html>
  <head>
    <title>From A to Bree - LotRO middle earth journey planner</title>
    <link rel="stylesheet" text="text/css" href="css/topcoat-desktop-light.min.css">
    <link rel="stylesheet" text="text/css" href="css/style.css">
    <script src="js/fromatobree-browser.js"></script>
  </head>
  <body>
    <table border="0">
      <tr><td colspan="2">Configuration</td></tr>
      <tr><td colspan="2"><input type="range"  min="1" max="9" step="1" id="level"></td></tr>
      <tr>
        <td>Start</td>
        <td>Finish</td>
      </tr>
      <tr>
        <!-- is autofocus buggy? goes to location after startRegion -->
        <td><select id="startRegion" tabindex="0" autofocus class="topcoat-button--large"></select></td>
        <td><select id="finishRegion" tabindex="2" class="topcoat-button--large"></select></td>
      </tr>
      <tr>
        <td><select id="startPlace" tabindex="1" class="topcoat-button--large"></select></td>
        <td><select id="finishPlace" tabindex="3" class="topcoat-button--large"></select></td>
      </tr>
      <tr>
        <td colspan="2"><button id="FindRoute" class="topcoat-button--large">Find Route</button></td>
      </tr>
      <tr>
        <td colspan="2"><textarea id="results" rows="20" cols="90" class="topcat-textarea--large">choose your starting and ending locations!</textarea></td>
    </table>

    <script>
      // initialisation
      var regions = fatb.GetRegions();
      var selStartRegion = document.getElementById("startRegion");
      var selFinishRegion = document.getElementById("finishRegion");
      var start, finish = "";
      var route = [], routeCost = {};

      for(var i=0; i<regions.length; i++) {
        selStartRegion.options[selStartRegion.options.length] = new Option(regions[i], regions[i]);
        selFinishRegion.options[selFinishRegion.options.length] = new Option(regions[i], regions[i]);
      }

      var startRegion = regions[0]; // angmar
      var places = fatb.GetPlacesByRegion(startRegion);

      var selStartPlace = document.getElementById("startPlace");
      var selFinishPlace = document.getElementById("finishPlace");

      // clear down before initialising places
      for(var i=selStartPlace.options.length; i >= 0; i--) {
        selStartPlace.remove(i);
        selFinishPlace.remove(i);
      }

      for(var i=0; i<places.length; i++) {
        selStartPlace.options[selStartPlace.options.length] = new Option(places[i], places[i]);
        selFinishPlace.options[selFinishPlace.options.length] = new Option(places[i], places[i]);
      }

      // events
      function onChangeRegion(evt) {
        var region = evt.srcElement.value;
        var source = /^(start|finish)Region/.exec(evt.srcElement.id)[1]; 
        var places = fatb.GetPlacesByRegion(region);
        var selPlace = document.getElementById(source+"Place");

        for(var i=selPlace.options.length; i >= 0; i--) {
          selPlace.remove(i);
        }

        for(var i=0; i<places.length; i++) {
          selPlace.options[selPlace.options.length] = new Option(places[i], places[i]);
          //console.log("%d=%s", i, places[i]);    
        }
      };

      var inputLevel = document.getElementById("level");
      inputLevel.addEventListener("change", function(evt) {
        // update span text for visual feedback
        console.log("level: %d", evt.srcElement.value);
      });
      selStartRegion.addEventListener("change", onChangeRegion); 
      selFinishRegion.addEventListener("change", onChangeRegion); 
      var button = document.getElementById("FindRoute");
      button.addEventListener("click", function(evt) {
        // console.log(fatb.FindPath(start,finish));
        route = fatb.FindPath(start,finish);
        routeCost = fatb.GetPathCostObject(route);
        console.log(routeCost);
        var message = "Your path: ";
        message += JSON.stringify(routeCost, null, 8);
        document.getElementById("results").value = message;
      });

      var selStartPlace = document.getElementById("startPlace");
      selStartPlace.addEventListener("change", function(evt) {
        console.log("you selected your start as %s", evt.srcElement.value);
        start = evt.srcElement.value;

      });
      var selFinishPlace = document.getElementById("finishPlace");
      selFinishPlace.addEventListener("change", function(evt) {
        console.log("you selected your finish as %s", evt.srcElement.value);
        finish = evt.srcElement.value;
      });
    </script>
</body>
</html>
